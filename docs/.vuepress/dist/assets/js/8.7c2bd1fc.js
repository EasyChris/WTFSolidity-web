(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{438:function(t,s,a){t.exports=a.p+"assets/img/30-1.2c917170.png"},439:function(t,s,a){t.exports=a.p+"assets/img/30-2.b06655ee.png"},440:function(t,s,a){t.exports=a.p+"assets/img/30-3.50b0b88e.png"},441:function(t,s,a){t.exports=a.p+"assets/img/30-4.39686696.png"},442:function(t,s,a){t.exports=a.p+"assets/img/30-5.4ca98df2.png"},503:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"solidity极简入门-30-try-catch"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#solidity极简入门-30-try-catch"}},[t._v("#")]),t._v(" Solidity极简入门: 30. Try Catch")]),t._v(" "),n("p",[t._v("我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。")]),t._v(" "),n("p",[t._v("欢迎关注我的推特："),n("a",{attrs:{href:"https://twitter.com/0xAA_Science",target:"_blank",rel:"noopener noreferrer"}},[t._v("@0xAA_Science"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("欢迎加入WTF科学家社区，内有加微信群方法："),n("a",{attrs:{href:"https://discord.gg/5akcruXrsk",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: "),n("a",{attrs:{href:"https://github.com/AmazingAng/WTFSolidity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/AmazingAng/WTFSolidity"),n("OutboundLink")],1)]),t._v(" "),n("hr"),t._v(" "),n("p",[n("code",[t._v("try-catch")]),t._v("是现代编程语言几乎都有的处理异常的一种标准方式，"),n("code",[t._v("solidity")]),t._v("0.6版本也添加了它。这一讲，我们将介绍如何利用"),n("code",[t._v("try-catch")]),t._v("处理智能合约中的异常。")]),t._v(" "),n("h2",{attrs:{id:"try-catch"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#try-catch"}},[t._v("#")]),t._v(" "),n("code",[t._v("try-catch")])]),t._v(" "),n("p",[t._v("在"),n("code",[t._v("solidity")]),t._v("中，"),n("code",[t._v("try-catch")]),t._v("只能被用于"),n("code",[t._v("external")]),t._v("函数或创建合约时"),n("code",[t._v("constructor")]),t._v("（被视为"),n("code",[t._v("external")]),t._v("函数）的调用。基本语法如下：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("        try externalContract"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call成功的情况下 运行一些代码")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" catch "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call失败的情况下 运行一些代码")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("其中"),n("code",[t._v("externalContract.f()")]),t._v("是某个外部合约的函数调用，"),n("code",[t._v("try")]),t._v("模块在调用成功的情况下运行，而"),n("code",[t._v("catch")]),t._v("模块则在调用失败时运行。")]),t._v(" "),n("p",[t._v("同样可以使用"),n("code",[t._v("this.f()")]),t._v("来替代"),n("code",[t._v("externalContract.f()")]),t._v("，"),n("code",[t._v("this.f()")]),t._v("也被视作为外部调用，但不可在构造函数中使用，因为此时合约还未创建。")]),t._v(" "),n("p",[t._v("如果调用的函数有返回值，那么必须在"),n("code",[t._v("try")]),t._v("之后声明"),n("code",[t._v("returns(returnType val)")]),t._v("，并且在"),n("code",[t._v("try")]),t._v("模块中可以使用返回的变量；如果是创建合约，那么返回值是新创建的合约变量。")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("        try externalContract"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnType val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call成功的情况下 运行一些代码")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" catch "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call失败的情况下 运行一些代码")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("另外，"),n("code",[t._v("catch")]),t._v("模块支持捕获特殊的异常原因：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("        try externalContract"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call成功的情况下 运行一些代码")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" catch "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 捕获失败的 revert() 和 require()")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" catch "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 捕获失败的 assert()")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"try-catch实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#try-catch实战"}},[t._v("#")]),t._v(" "),n("code",[t._v("try-catch")]),t._v("实战")]),t._v(" "),n("h3",{attrs:{id:"onlyeven"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#onlyeven"}},[t._v("#")]),t._v(" "),n("code",[t._v("OnlyEven")])]),t._v(" "),n("p",[t._v("我们创建一个外部合约"),n("code",[t._v("OnlyEven")]),t._v("，并使用"),n("code",[t._v("try-catch")]),t._v("来处理异常：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("contract")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OnlyEven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"invalid number"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onlyEven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pure")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输入奇数时revert")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ups! Reverting"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        success "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("OnlyEven")]),t._v("合约包含一个构造函数和一个"),n("code",[t._v("onlyEven")]),t._v("函数。")]),t._v(" "),n("ul",[n("li",[t._v("构造函数有一个参数"),n("code",[t._v("a")]),t._v("，当"),n("code",[t._v("a=0")]),t._v("时，"),n("code",[t._v("require")]),t._v("会抛出异常；当"),n("code",[t._v("a=1")]),t._v("时，"),n("code",[t._v("assert")]),t._v("会抛出异常；其他情况均正常。")]),t._v(" "),n("li",[n("code",[t._v("onlyEven")]),t._v("函数有一个参数"),n("code",[t._v("b")]),t._v("，当"),n("code",[t._v("b")]),t._v("为奇数时，"),n("code",[t._v("require")]),t._v("会抛出异常。")])]),t._v(" "),n("h3",{attrs:{id:"处理外部函数调用异常"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#处理外部函数调用异常"}},[t._v("#")]),t._v(" 处理外部函数调用异常")]),t._v(" "),n("p",[t._v("首先，在"),n("code",[t._v("TryCatch")]),t._v("合约中定义一些事件和状态变量：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 成功event")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("event")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SuccessEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 失败event")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("event")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CatchEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("event")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CatchByte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明OnlyEven合约变量")]),t._v("\n    OnlyEven even"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        even "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OnlyEven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("SuccessEvent")]),t._v("是调用成功会释放的事件，而"),n("code",[t._v("CatchEvent")]),t._v("和"),n("code",[t._v("CatchByte")]),t._v("是抛出异常时会释放的事件，分别对应"),n("code",[t._v("require/revert")]),t._v("和"),n("code",[t._v("assert")]),t._v("异常的情况。"),n("code",[t._v("even")]),t._v("是个"),n("code",[t._v("OnlyEven")]),t._v("合约类型的状态变量。")]),t._v(" "),n("p",[t._v("然后我们在"),n("code",[t._v("execute")]),t._v("函数中使用"),n("code",[t._v("try-catch")]),t._v("处理调用外部函数"),n("code",[t._v("onlyEven")]),t._v("中的异常：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在external call中使用try-catch")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        try even"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onlyEven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" _success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call成功的情况下")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("emit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SuccessEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" _success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" catch "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call不成功的情况下")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("emit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CatchEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"在remix上验证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在remix上验证"}},[t._v("#")]),t._v(" 在remix上验证")]),t._v(" "),n("p",[t._v("当运行"),n("code",[t._v("execute(0)")]),t._v("的时候，因为"),n("code",[t._v("0")]),t._v("为偶数，满足"),n("code",[t._v('require(b % 2 == 0, "Ups! Reverting");')]),t._v("，没有异常抛出，调用成功并释放"),n("code",[t._v("SuccessEvent")]),t._v("事件。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(438),alt:""}})]),t._v(" "),n("p",[t._v("当运行"),n("code",[t._v("execute(1)")]),t._v("的时候，因为"),n("code",[t._v("1")]),t._v("为奇数，不满足"),n("code",[t._v('require(b % 2 == 0, "Ups! Reverting");')]),t._v("，异常抛出，调用失败并释放"),n("code",[t._v("CatchEvent")]),t._v("事件。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(439),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"处理合约创建异常"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#处理合约创建异常"}},[t._v("#")]),t._v(" 处理合约创建异常")]),t._v(" "),n("p",[t._v("这里，我们利用"),n("code",[t._v("try-catch")]),t._v("来处理合约创建时的异常。只需要把"),n("code",[t._v("try")]),t._v("模块改写为"),n("code",[t._v("OnlyEven")]),t._v("合约的创建就行：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在创建新合约中使用try-catch （合约创建被视为external call）")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executeNew(0)会失败并释放`CatchEvent`")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executeNew(1)会失败并释放`CatchByte`")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executeNew(2)会成功并释放`SuccessEvent`")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeNew")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        try "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OnlyEven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OnlyEven _even"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call成功的情况下")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("emit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SuccessEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            success "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _even"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onlyEven")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" catch "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// catch失败的 revert() 和 require()")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("emit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CatchEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" catch "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// catch失败的 assert()")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("emit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CatchByte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"在remix上验证-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在remix上验证-2"}},[t._v("#")]),t._v(" 在remix上验证")]),t._v(" "),n("p",[t._v("当运行"),n("code",[t._v("executeNew(0)")]),t._v("时，因为"),n("code",[t._v("0")]),t._v("不满足"),n("code",[t._v('require(a != 0, "invalid number");')]),t._v("，会失败并释放"),n("code",[t._v("CatchEvent")]),t._v("事件。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(440),alt:""}})]),t._v(" "),n("p",[t._v("当运行"),n("code",[t._v("executeNew(1)")]),t._v("时，因为"),n("code",[t._v("1")]),t._v("不满足"),n("code",[t._v("assert(a != 1);")]),t._v("，会失败并释放"),n("code",[t._v("CatchByte")]),t._v("事件。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(441),alt:""}})]),t._v(" "),n("p",[t._v("当运行"),n("code",[t._v("executeNew(2)")]),t._v("时，因为"),n("code",[t._v("2")]),t._v("满足"),n("code",[t._v('require(a != 0, "invalid number");')]),t._v("和"),n("code",[t._v("assert(a != 1);")]),t._v("，会成功并释放"),n("code",[t._v("SuccessEvent")]),t._v("事件。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(442),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("在这一讲，我们介绍了如何在"),n("code",[t._v("solidity")]),t._v("使用"),n("code",[t._v("try-catch")]),t._v("来处理智能合约运行中的异常：")]),t._v(" "),n("ul",[n("li",[t._v("只能用于外部合约调用和合约创建。")]),t._v(" "),n("li",[t._v("如果"),n("code",[t._v("try")]),t._v("执行成功，返回变量必须声明，并且与返回的变量类型相同。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);