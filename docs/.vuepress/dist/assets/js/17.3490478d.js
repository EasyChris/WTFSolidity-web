(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{368:function(t,s,a){t.exports=a.p+"assets/img/7-1.69dd365d.jpg"},369:function(t,s,a){t.exports=a.p+"assets/img/7-2.7af0a73a.jpg"},370:function(t,s,a){t.exports=a.p+"assets/img/7-3.a065c115.jpg"},488:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"solidity极简入门-7-映射类型-mapping"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#solidity极简入门-7-映射类型-mapping"}},[t._v("#")]),t._v(" Solidity极简入门: 7. 映射类型 mapping")]),t._v(" "),e("p",[t._v("我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。")]),t._v(" "),e("p",[t._v("欢迎关注我的推特："),e("a",{attrs:{href:"https://twitter.com/0xAA_Science",target:"_blank",rel:"noopener noreferrer"}},[t._v("@0xAA_Science"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("WTF技术社群discord，内有加微信群方法："),e("a",{attrs:{href:"https://discord.gg/5akcruXrsk",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: "),e("a",{attrs:{href:"https://github.com/AmazingAng/WTFSolidity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/AmazingAng/WTFSolidity"),e("OutboundLink")],1)]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("这一讲，我们将介绍solidity中的哈希表：映射（"),e("code",[t._v("Mapping")]),t._v("）类型。")]),t._v(" "),e("h2",{attrs:{id:"映射mapping"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#映射mapping"}},[t._v("#")]),t._v(" 映射Mapping")]),t._v(" "),e("p",[t._v("在映射中，人们可以通过键（"),e("code",[t._v("Key")]),t._v("）来查询对应的值（"),e("code",[t._v("Value")]),t._v("），比如：通过一个人的"),e("code",[t._v("id")]),t._v("来查询他的钱包地址。")]),t._v(" "),e("p",[t._v("声明映射的格式为"),e("code",[t._v("mapping(_KeyType => _ValueType)")]),t._v("，其中"),e("code",[t._v("_KeyType")]),t._v("和"),e("code",[t._v("_ValueType")]),t._v("分别是"),e("code",[t._v("Key")]),t._v("和"),e("code",[t._v("Value")]),t._v("的变量类型。例子：")]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mapping")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" idToAddress"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// id映射到地址")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mapping")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" swapPair"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 币对的映射，地址到地址")]),t._v("\n")])])]),e("h2",{attrs:{id:"映射的规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#映射的规则"}},[t._v("#")]),t._v(" 映射的规则")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("规则1")]),t._v("：映射的"),e("code",[t._v("_KeyType")]),t._v("只能选择"),e("code",[t._v("solidity")]),t._v("默认的类型，比如"),e("code",[t._v("uint")]),t._v("，"),e("code",[t._v("address")]),t._v("等，不能用自定义的结构体。而"),e("code",[t._v("_ValueType")]),t._v("可以使用自定义的类型。下面这个例子会报错，因为"),e("code",[t._v("_KeyType")]),t._v("使用了我们自定义的结构体：")])]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们定义一个结构体 Struct")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Student")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" score"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mapping")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Student "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" testVar"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("ul",[e("li",[e("p",[e("strong",[t._v("规则2")]),t._v("：映射的存储位置必须是"),e("code",[t._v("storage")]),t._v("，因此可以用于合约的状态变量，函数中的"),e("code",[t._v("storage")]),t._v("变量。不能用于"),e("code",[t._v("public")]),t._v("函数的参数或返回结果中，因为"),e("code",[t._v("mapping")]),t._v("记录的是一种关系 (key - value pair)。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("规则3")]),t._v("：如果映射声明为"),e("code",[t._v("public")]),t._v("，那么"),e("code",[t._v("solidity")]),t._v("会自动给你创建一个"),e("code",[t._v("getter")]),t._v("函数，可以通过"),e("code",[t._v("Key")]),t._v("来查询对应的"),e("code",[t._v("Value")]),t._v("。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("规则4")]),t._v("：给映射新增的键值对的语法为"),e("code",[t._v("_Var[_Key] = _Value")]),t._v("，其中"),e("code",[t._v("_Var")]),t._v("是映射变量名，"),e("code",[t._v("_Key")]),t._v("和"),e("code",[t._v("_Value")]),t._v("对应新增的键值对。例子：")])])]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" writeMap "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" _Key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _Value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        idToAddress"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_Key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _Value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"映射的原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#映射的原理"}},[t._v("#")]),t._v(" 映射的原理")]),t._v(" "),e("ul",[e("li",[e("p",[e("strong",[t._v("原理1")]),t._v(": 映射不储存任何键（"),e("code",[t._v("Key")]),t._v("）的资讯，也没有length的资讯。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("原理2")]),t._v(": 映射使用"),e("code",[t._v("keccak256(key)")]),t._v("当成offset存取value。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("原理3")]),t._v(": 因为Ethereum会定义所以未使用的空间为0，所以对于所以未赋值（"),e("code",[t._v("Value")]),t._v("）的键（"),e("code",[t._v("Key")]),t._v("），其初始值都是0。")])])]),t._v(" "),e("h2",{attrs:{id:"在remix上验证-以-mapping-sol为例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在remix上验证-以-mapping-sol为例"}},[t._v("#")]),t._v(" 在Remix上验证 (以 "),e("code",[t._v("Mapping.sol")]),t._v("为例)")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("映射示例 1 部署")]),t._v(" "),e("p",[e("img",{attrs:{src:a(368),alt:"7-1"}})])]),t._v(" "),e("li",[e("p",[t._v("映射示例 2 初始值")]),t._v(" "),e("p",[e("img",{attrs:{src:a(369),alt:"7-2"}})])]),t._v(" "),e("li",[e("p",[t._v("映射示例 3 key-value pair")]),t._v(" "),e("p",[e("img",{attrs:{src:a(370),alt:"7-3"}})])])]),t._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[t._v("这一讲，我们介绍了"),e("code",[t._v("solidity")]),t._v("中哈希表——映射（"),e("code",[t._v("Mapping")]),t._v("）的用法。至此，我们已经学习了所有常用变量种类，之后我们会学习控制流"),e("code",[t._v("if-else")]),t._v(","),e("code",[t._v("while")]),t._v("等。")])])}),[],!1,null,null,null);s.default=n.exports}}]);