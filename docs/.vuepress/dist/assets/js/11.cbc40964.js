(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{366:function(t,s,a){t.exports=a.p+"assets/img/5-1.b397b502.png"},367:function(t,s,a){t.exports=a.p+"assets/img/5-2.7b28744d.png"},368:function(t,s,a){t.exports=a.p+"assets/img/5-3.c6cdf9af.png"},369:function(t,s,a){t.exports=a.p+"assets/img/5-4.a8f8ded6.png"},478:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"solidity极简入门-5-变量数据存储和作用域-storage-memory-calldata"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#solidity极简入门-5-变量数据存储和作用域-storage-memory-calldata"}},[t._v("#")]),t._v(" Solidity极简入门: 5. 变量数据存储和作用域 storage/memory/calldata")]),t._v(" "),n("p",[t._v("我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。")]),t._v(" "),n("p",[t._v("欢迎关注我的推特："),n("a",{attrs:{href:"https://twitter.com/0xAA_Science",target:"_blank",rel:"noopener noreferrer"}},[t._v("@0xAA_Science"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("WTF技术社群discord，内有加微信群方法："),n("a",{attrs:{href:"https://discord.gg/5akcruXrsk",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: "),n("a",{attrs:{href:"https://github.com/AmazingAng/WTFSolidity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/AmazingAng/WTFSolidity"),n("OutboundLink")],1)]),t._v(" "),n("hr"),t._v(" "),n("h2",{attrs:{id:"solidity中的引用类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#solidity中的引用类型"}},[t._v("#")]),t._v(" Solidity中的引用类型")]),t._v(" "),n("p",[n("strong",[t._v("引用类型(Reference Type)")]),t._v("：包括数组（"),n("code",[t._v("array")]),t._v("），结构体（"),n("code",[t._v("struct")]),t._v("）和映射（"),n("code",[t._v("mapping")]),t._v("），这类变量占空间大，赋值时候直接传递地址（类似指针）。由于这类变量比较复杂，占用存储空间大，我们在使用时必须要声明数据存储的位置。")]),t._v(" "),n("h2",{attrs:{id:"数据位置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据位置"}},[t._v("#")]),t._v(" 数据位置")]),t._v(" "),n("p",[t._v("solidity数据存储位置有三类："),n("code",[t._v("storage")]),t._v("，"),n("code",[t._v("memory")]),t._v("和"),n("code",[t._v("calldata")]),t._v("。不同存储位置的"),n("code",[t._v("gas")]),t._v("成本不同。"),n("code",[t._v("storage")]),t._v("类型的数据存在链上，类似计算机的硬盘，消耗"),n("code",[t._v("gas")]),t._v("多；"),n("code",[t._v("memory")]),t._v("和"),n("code",[t._v("calldata")]),t._v("类型的临时存在内存里，消耗"),n("code",[t._v("gas")]),t._v("少。大致用法：")]),t._v(" "),n("ol",[n("li",[n("p",[n("code",[t._v("storage")]),t._v("：合约里的状态变量默认都是"),n("code",[t._v("storage")]),t._v("，存储在链上。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("memory")]),t._v("：函数里的参数和临时变量一般用"),n("code",[t._v("memory")]),t._v("，存储在内存中，不上链。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("calldata")]),t._v("：和"),n("code",[t._v("memory")]),t._v("类似，存储在内存中，不上链。与"),n("code",[t._v("memory")]),t._v("的不同点在于"),n("code",[t._v("calldata")]),t._v("变量不能修改（"),n("code",[t._v("immutable")]),t._v("），一般用于函数的参数。例子：")])])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fCalldata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pure")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//参数为calldata数组，不能被修改")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// _x[0] = 0 //这样修改会报错")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("Example:")]),t._v(" "),n("img",{attrs:{src:a(366),alt:"5-1.png"}})]),t._v(" "),n("h3",{attrs:{id:"不同类型相互赋值时的规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不同类型相互赋值时的规则"}},[t._v("#")]),t._v(" 不同类型相互赋值时的规则")]),t._v(" "),n("p",[t._v("在不同存储类型相互赋值时候，有时会产生独立的副本（修改新变量不会影响原变量），有时会产生引用（修改新变量会影响原变量）。规则如下：")]),t._v(" "),n("ol",[n("li",[n("code",[t._v("storage")]),t._v("（合约的状态变量）赋值给本地"),n("code",[t._v("storage")]),t._v("（函数里的）时候，会创建引用，改变新变量会影响原变量。例子：")])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 状态变量：数组 x")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fStorage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//声明一个storage的变量 xStorage，指向x。修改xStorage也会影响x")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("storage")]),t._v(" xStorage "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        xStorage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("Example:")]),t._v(" "),n("img",{attrs:{src:a(367),alt:"5-2.png"}})]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("code",[t._v("storage")]),t._v("赋值给"),n("code",[t._v("memory")]),t._v("，会创建独立的复本，修改其中一个不会影响另一个；反之亦然。例子：")])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 状态变量：数组 x")]),t._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fMemory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//声明一个Memory的变量xMemory，复制x。修改xMemory不会影响x")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" xMemory "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        xMemory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("Example:")]),t._v(" "),n("img",{attrs:{src:a(368),alt:"5-3.png"}})]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[n("p",[n("code",[t._v("memory")]),t._v("赋值给"),n("code",[t._v("memory")]),t._v("，会创建引用，改变新变量会影响原变量。")])]),t._v(" "),n("li",[n("p",[t._v("其他情况，变量赋值给"),n("code",[t._v("storage")]),t._v("，会创建独立的复本，修改其中一个不会影响另一个。")])])]),t._v(" "),n("h2",{attrs:{id:"变量的作用域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#变量的作用域"}},[t._v("#")]),t._v(" 变量的作用域")]),t._v(" "),n("p",[n("code",[t._v("Solidity")]),t._v("中变量按作用域划分有三种，分别是状态变量（state variable），局部变量（local variable）和全局变量(global variable)")]),t._v(" "),n("h3",{attrs:{id:"_1-状态变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-状态变量"}},[t._v("#")]),t._v(" 1. 状态变量")]),t._v(" "),n("p",[t._v("状态变量是数据存储在链上的变量，所有合约内函数都可以访问\n，"),n("code",[t._v("gas")]),t._v("消耗高。状态变量在合约内、函数外声明：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("contract")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Variables")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" z"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我们可以在函数里更改状态变量的值：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以在函数里更改状态变量的值")]),t._v("\n        x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        z "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0xAA"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_2-局部变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-局部变量"}},[t._v("#")]),t._v(" 2. 局部变量")]),t._v(" "),n("p",[t._v("局部变量是仅在函数执行过程中有效的变量，函数退出后，变量无效。局部变量的数据存储在内存里，不上链，"),n("code",[t._v("gas")]),t._v("低。局部变量在函数内声明：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pure")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" xx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" yy "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" zz "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" xx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" yy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-全局变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-全局变量"}},[t._v("#")]),t._v(" 3. 全局变量")]),t._v(" "),n("p",[t._v("全局变量是全局范围工作的变量，都是"),n("code",[t._v("solidity")]),t._v("预留关键字。他们可以在函数内不声明直接使用：")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("global")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("view")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" sender "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" blockNum "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" block"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" blockNum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("在上面例子里，我们使用了3个常用的全局变量："),n("code",[t._v("msg.sender")]),t._v(", "),n("code",[t._v("block.number")]),t._v("和"),n("code",[t._v("msg.data")]),t._v("，他们分别代表请求发起地址，当前区块高度，和请求数据。下面是一些常用的全局变量，更完整的列表请看这个"),n("a",{attrs:{href:"https://learnblockchain.cn/docs/solidity/units-and-global-variables.html#special-variables-and-functions",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),n("OutboundLink")],1),t._v("：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("blockhash(uint blockNumber)")]),t._v(": ("),n("code",[t._v("bytes32")]),t._v(")给定区块的哈希值 – 只适用于256最近区块, 不包含当前区块。")]),t._v(" "),n("li",[n("code",[t._v("block.coinbase")]),t._v(": ("),n("code",[t._v("address payable")]),t._v(") 当前区块矿工的地址")]),t._v(" "),n("li",[n("code",[t._v("block.gaslimit")]),t._v(": ("),n("code",[t._v("uint")]),t._v(")\t当前区块的gaslimit")]),t._v(" "),n("li",[n("code",[t._v("block.number")]),t._v(": ("),n("code",[t._v("uint")]),t._v(")\t当前区块的number")]),t._v(" "),n("li",[n("code",[t._v("block.timestamp")]),t._v(": ("),n("code",[t._v("uint")]),t._v(")\t当前区块的时间戳，为unix纪元以来的秒")]),t._v(" "),n("li",[n("code",[t._v("gasleft()")]),t._v(": ("),n("code",[t._v("uint256")]),t._v(")\t剩余 gas")]),t._v(" "),n("li",[n("code",[t._v("msg.data")]),t._v(": ("),n("code",[t._v("bytes calldata")]),t._v(")\t完整call data")]),t._v(" "),n("li",[n("code",[t._v("msg.sender")]),t._v(": ("),n("code",[t._v("address payable")]),t._v(")\t消息发送者 (当前 caller)")]),t._v(" "),n("li",[n("code",[t._v("msg.sig")]),t._v(": ("),n("code",[t._v("bytes4")]),t._v(")\tcalldata的前四个字节 (function identifier)")]),t._v(" "),n("li",[n("code",[t._v("msg.value")]),t._v(": ("),n("code",[t._v("uint")]),t._v(")\t当前交易发送的"),n("code",[t._v("wei")]),t._v("值")]),t._v(" "),n("li",[n("code",[t._v("now")]),t._v(": ("),n("code",[t._v("uint")]),t._v(")\t当前块的时间戳")])]),t._v(" "),n("p",[n("strong",[t._v("Example:")]),t._v(" "),n("img",{attrs:{src:a(369),alt:"5-4.png"}})]),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("在第4讲，我们介绍了"),n("code",[t._v("solidity")]),t._v("中的引用类型，数据位置和变量的作用域。重点是"),n("code",[t._v("storage")]),t._v(", "),n("code",[t._v("memory")]),t._v("和"),n("code",[t._v("calldata")]),t._v("三个关键字的用法。他们出现的原因是为了节省链上有限的存储空间和降低"),n("code",[t._v("gas")]),t._v("。下一讲我们会介绍引用类型中的数组。")])])}),[],!1,null,null,null);s.default=e.exports}}]);