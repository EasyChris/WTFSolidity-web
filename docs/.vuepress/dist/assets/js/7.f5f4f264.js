(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{418:function(t,a,s){t.exports=s.p+"assets/img/23-1.3bc4ad9c.png"},419:function(t,a,s){t.exports=s.p+"assets/img/23-2.02ee9109.png"},420:function(t,a,s){t.exports=s.p+"assets/img/23-3.b8084976.png"},421:function(t,a,s){t.exports=s.p+"assets/img/23-4.1d74325d.png"},422:function(t,a,s){t.exports=s.p+"assets/img/23-5.91872d39.png"},423:function(t,a,s){t.exports=s.p+"assets/img/23-6.828f24bb.png"},496:function(t,a,s){"use strict";s.r(a);var e=s(42),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"solidity极简入门-23-delegatecall"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#solidity极简入门-23-delegatecall"}},[t._v("#")]),t._v(" Solidity极简入门: 23. Delegatecall")]),t._v(" "),e("p",[t._v("我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。")]),t._v(" "),e("p",[t._v("欢迎关注我的推特："),e("a",{attrs:{href:"https://twitter.com/0xAA_Science",target:"_blank",rel:"noopener noreferrer"}},[t._v("@0xAA_Science"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("WTF技术社群discord，内有加微信群方法："),e("a",{attrs:{href:"https://discord.gg/5akcruXrsk",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: "),e("a",{attrs:{href:"https://github.com/AmazingAng/WTFSolidity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/AmazingAng/WTFSolidity"),e("OutboundLink")],1)]),t._v(" "),e("hr"),t._v(" "),e("h2",{attrs:{id:"delegatecall"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#delegatecall"}},[t._v("#")]),t._v(" "),e("code",[t._v("delegatecall")])]),t._v(" "),e("p",[e("code",[t._v("delegatecall")]),t._v("与"),e("code",[t._v("call")]),t._v("类似，是"),e("code",[t._v("solidity")]),t._v("中地址类型的低级成员函数。"),e("code",[t._v("delegate")]),t._v("中是委托/代表的意思，那么"),e("code",[t._v("delegatecall")]),t._v("委托了什么？")]),t._v(" "),e("p",[t._v("当用户"),e("code",[t._v("A")]),t._v("通过合约"),e("code",[t._v("B")]),t._v("来"),e("code",[t._v("call")]),t._v("合约"),e("code",[t._v("C")]),t._v("的时候，执行的是合约"),e("code",[t._v("C")]),t._v("的函数，"),e("code",[t._v("语境")]),t._v("("),e("code",[t._v("Context")]),t._v("，可以理解为包含变量和状态的环境)也是合约"),e("code",[t._v("C")]),t._v("的："),e("code",[t._v("msg.sender")]),t._v("是"),e("code",[t._v("B")]),t._v("的地址，并且如果函数改变一些状态变量，产生的效果会作用于合约"),e("code",[t._v("C")]),t._v("的变量上。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://images.mirror-media.xyz/publication-images/VgMR533pA8WYtE5Lr65mQ.png?height=698&width=1860",alt:"call的语境"}})]),t._v(" "),e("p",[t._v("而当用户"),e("code",[t._v("A")]),t._v("通过合约"),e("code",[t._v("B")]),t._v("来"),e("code",[t._v("delegatecall")]),t._v("合约"),e("code",[t._v("C")]),t._v("的时候，执行的是合约"),e("code",[t._v("C")]),t._v("的函数，但是"),e("code",[t._v("语境")]),t._v("仍是合约"),e("code",[t._v("B")]),t._v("的："),e("code",[t._v("msg.sender")]),t._v("是"),e("code",[t._v("A")]),t._v("的地址，并且如果函数改变一些状态变量，产生的效果会作用于合约"),e("code",[t._v("B")]),t._v("的变量上。")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://images.mirror-media.xyz/publication-images/JucQiWVixdlmJl6zHjCSI.png?height=702&width=1862",alt:"delegatecall的语境"}})]),t._v(" "),e("p",[t._v("大家可以这样理解：一个"),e("code",[t._v("富商")]),t._v("把它的资产（"),e("code",[t._v("状态变量")]),t._v("）都交给一个"),e("code",[t._v("VC")]),t._v("代理（"),e("code",[t._v("目标合约")]),t._v("的函数）来打理。执行的是"),e("code",[t._v("VC")]),t._v("的函数，但是改变的是"),e("code",[t._v("富商")]),t._v("的状态。")]),t._v(" "),e("p",[e("code",[t._v("delegatecall")]),t._v("语法和"),e("code",[t._v("call")]),t._v("类似，也是：")]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[t._v("目标合约地址"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("delegatecall")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("二进制编码"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("其中"),e("code",[t._v("二进制编码")]),t._v("利用结构化编码函数"),e("code",[t._v("abi.encodeWithSignature")]),t._v("获得：")]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[t._v("abi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeWithSignature")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"函数签名"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 逗号分隔的具体参数"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[e("code",[t._v("函数签名")]),t._v("为"),e("code",[t._v('"函数名（逗号分隔的参数类型)"')]),t._v("。例如"),e("code",[t._v('abi.encodeWithSignature("f(uint256,address)", _x, _addr)')]),t._v("。")]),t._v(" "),e("p",[t._v("和"),e("code",[t._v("call")]),t._v("不一样，"),e("code",[t._v("delegatecall")]),t._v("在调用合约时可以指定交易发送的"),e("code",[t._v("gas")]),t._v("，但不能指定发送的"),e("code",[t._v("ETH")]),t._v("数额")]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("注意")]),t._v("："),e("code",[t._v("delegatecall")]),t._v("有安全隐患，使用时要保证当前合约和目标合约的状态变量存储结构相同，并且目标合约安全，不然会造成资产损失。")])]),t._v(" "),e("h2",{attrs:{id:"什么情况下会用到delegatecall"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么情况下会用到delegatecall"}},[t._v("#")]),t._v(" 什么情况下会用到"),e("code",[t._v("delegatecall")]),t._v("?")]),t._v(" "),e("p",[t._v("目前"),e("code",[t._v("delegatecall")]),t._v("主要有两个应用场景：")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("代理合约（"),e("code",[t._v("Proxy Contract")]),t._v("）：将智能合约的存储合约和逻辑合约分开：代理合约（"),e("code",[t._v("Proxy Contract")]),t._v("）存储所有相关的变量，并且保存逻辑合约的地址；所有函数存在逻辑合约（"),e("code",[t._v("Logic Contract")]),t._v("）里，通过"),e("code",[t._v("delegatecall")]),t._v("执行。当升级时，只需要将代理合约指向新的逻辑合约即可。")])]),t._v(" "),e("li",[e("p",[t._v("EIP-2535 Diamonds（钻石）：钻石是一个支持构建可在生产中扩展的模块化智能合约系统的标准。钻石是具有多个实施合同的代理合同。 更多信息请查看："),e("a",{attrs:{href:"https://eip2535diamonds.substack.com/p/introduction-to-the-diamond-standard",target:"_blank",rel:"noopener noreferrer"}},[t._v("钻石标准简介"),e("OutboundLink")],1),t._v("。")])])]),t._v(" "),e("h2",{attrs:{id:"delegatecall例子"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#delegatecall例子"}},[t._v("#")]),t._v(" "),e("code",[t._v("delegatecall")]),t._v("例子")]),t._v(" "),e("p",[t._v("调用结构：你（"),e("code",[t._v("A")]),t._v("）通过合约"),e("code",[t._v("B")]),t._v("调用目标合约"),e("code",[t._v("C")]),t._v("。")]),t._v(" "),e("h3",{attrs:{id:"被调用的合约c"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#被调用的合约c"}},[t._v("#")]),t._v(" 被调用的合约C")]),t._v(" "),e("p",[t._v("我们先写一个简单的目标合约"),e("code",[t._v("C")]),t._v("：有两个"),e("code",[t._v("public")]),t._v("变量："),e("code",[t._v("num")]),t._v("和"),e("code",[t._v("sender")]),t._v("，分别是"),e("code",[t._v("uint256")]),t._v("和"),e("code",[t._v("address")]),t._v("类型；有一个函数，可以将"),e("code",[t._v("num")]),t._v("设定为传入的"),e("code",[t._v("_num")]),t._v("，并且将"),e("code",[t._v("sender")]),t._v("设为"),e("code",[t._v("msg.sender")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 被调用的合约C")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("contract")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("C")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" sender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setVars")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" _num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("payable")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        num "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        sender "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" msg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"发起调用的合约b"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发起调用的合约b"}},[t._v("#")]),t._v(" 发起调用的合约B")]),t._v(" "),e("p",[t._v("首先，合约"),e("code",[t._v("B")]),t._v("必须和目标合约"),e("code",[t._v("C")]),t._v("的变量存储布局必须相同，两个变量，并且顺序为"),e("code",[t._v("num")]),t._v("和"),e("code",[t._v("sender")])]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("contract")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("B")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" sender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("接下来，我们分别用"),e("code",[t._v("call")]),t._v("和"),e("code",[t._v("delegatecall")]),t._v("来调用合约"),e("code",[t._v("C")]),t._v("的"),e("code",[t._v("setVars")]),t._v("函数，更好的理解它们的区别。")]),t._v(" "),e("p",[e("code",[t._v("callSetVars")]),t._v("函数通过"),e("code",[t._v("call")]),t._v("来调用"),e("code",[t._v("setVars")]),t._v("。它有两个参数"),e("code",[t._v("_addr")]),t._v("和"),e("code",[t._v("_num")]),t._v("，分别对应合约"),e("code",[t._v("C")]),t._v("的地址和"),e("code",[t._v("setVars")]),t._v("的参数。")]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过call来调用C的setVars()函数，将改变合约C里的状态变量")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("callSetVars")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _addr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" _num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("payable")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// call setVars()")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" success"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _addr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            abi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeWithSignature")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setVars(uint256)"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("而"),e("code",[t._v("delegatecallSetVars")]),t._v("函数通过"),e("code",[t._v("delegatecall")]),t._v("来调用"),e("code",[t._v("setVars")]),t._v("。与上面的"),e("code",[t._v("callSetVars")]),t._v("函数相同，有两个参数"),e("code",[t._v("_addr")]),t._v("和"),e("code",[t._v("_num")]),t._v("，分别对应合约"),e("code",[t._v("C")]),t._v("的地址和"),e("code",[t._v("setVars")]),t._v("的参数。")]),t._v(" "),e("div",{staticClass:"language-solidity extra-class"},[e("pre",{pre:!0,attrs:{class:"language-solidity"}},[e("code",[t._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过delegatecall来调用C的setVars()函数，将改变合约B里的状态变量")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("delegatecallSetVars")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _addr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" _num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("payable")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// delegatecall setVars()")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" success"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("memory")]),t._v(" data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _addr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("delegatecall")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            abi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeWithSignature")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setVars(uint256)"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _num"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h3",{attrs:{id:"在remix上验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在remix上验证"}},[t._v("#")]),t._v(" 在remix上验证")]),t._v(" "),e("ol",[e("li",[t._v("首先，我们把合约"),e("code",[t._v("B")]),t._v("和"),e("code",[t._v("C")]),t._v("都部署好")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(418),alt:"deploy.png"}})]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("部署之后，查看"),e("code",[t._v("C")]),t._v("合约状态变量的初始值，"),e("code",[t._v("B")]),t._v("合约的状态变量也是一样。")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(419),alt:"initialstate.png"}})]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[t._v("此时，调用合约"),e("code",[t._v("B")]),t._v("中的"),e("code",[t._v("callSetVars")]),t._v("，传入参数为合约"),e("code",[t._v("C")]),t._v("地址和"),e("code",[t._v("10")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(420),alt:"call.png"}})]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[t._v("运行后，合约"),e("code",[t._v("C")]),t._v("中的状态变量将被修改："),e("code",[t._v("num")]),t._v("被改为"),e("code",[t._v("10")]),t._v("，"),e("code",[t._v("sender")]),t._v("变为合约"),e("code",[t._v("B")]),t._v("的地址")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(421),alt:"resultcall.png"}})]),t._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[t._v("接下来，我们调用合约"),e("code",[t._v("B")]),t._v("中的"),e("code",[t._v("delegatecallSetVars")]),t._v("，传入参数为合约"),e("code",[t._v("C")]),t._v("地址和"),e("code",[t._v("100")])])]),t._v(" "),e("p",[e("img",{attrs:{src:s(422),alt:"delegatecall.png"}})]),t._v(" "),e("ol",{attrs:{start:"6"}},[e("li",[t._v("由于是"),e("code",[t._v("delegatecall")]),t._v("，语境为合约"),e("code",[t._v("B")]),t._v("。在运行后，合约"),e("code",[t._v("B")]),t._v("中的状态变量将被修改："),e("code",[t._v("num")]),t._v("被改为"),e("code",[t._v("100")]),t._v("，"),e("code",[t._v("sender")]),t._v("变为你的钱包地址。合约"),e("code",[t._v("C")]),t._v("中的状态变量不会被修改。")])]),t._v(" "),e("p",[e("img",{attrs:{src:s(423),alt:"resultdelegatecall.png"}})]),t._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[t._v("这一讲我们介绍了"),e("code",[t._v("solidity")]),t._v("中的另一个低级函数"),e("code",[t._v("delegatecall")]),t._v("。与"),e("code",[t._v("call")]),t._v("类似，它可以用来调用其他合约；不同点在于运行的语境，"),e("code",[t._v("B call C")]),t._v("，语境为"),e("code",[t._v("C")]),t._v("；而"),e("code",[t._v("B delegatecall C")]),t._v("，语境为"),e("code",[t._v("B")]),t._v("。目前"),e("code",[t._v("delegatecall")]),t._v("最大的应用是代理合约和"),e("code",[t._v("EIP-2535 Diamonds")]),t._v("（钻石）。")])])}),[],!1,null,null,null);a.default=n.exports}}]);