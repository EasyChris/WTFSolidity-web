(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{446:function(t,s,a){t.exports=a.p+"assets/img/33-1.1fbfc774.png"},447:function(t,s,a){t.exports=a.p+"assets/img/33-2.4b678eb1.png"},448:function(t,s,a){t.exports=a.p+"assets/img/33-3.a51dbd68.png"},449:function(t,s,a){t.exports=a.p+"assets/img/33-4.493c2843.png"},450:function(t,s,a){t.exports=a.p+"assets/img/33-5.be2eaadd.png"},515:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"solidity极简入门-33-空投合约"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#solidity极简入门-33-空投合约"}},[t._v("#")]),t._v(" Solidity极简入门: 33. 空投合约")]),t._v(" "),n("p",[t._v("我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。")]),t._v(" "),n("p",[t._v("欢迎关注我的推特："),n("a",{attrs:{href:"https://twitter.com/0xAA_Science",target:"_blank",rel:"noopener noreferrer"}},[t._v("@0xAA_Science"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("欢迎加入WTF科学家社区，内有加微信群方法："),n("a",{attrs:{href:"https://discord.gg/5akcruXrsk",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: "),n("a",{attrs:{href:"https://github.com/AmazingAng/WTFSolidity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/AmazingAng/WTFSolidity"),n("OutboundLink")],1)]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("在币圈，最开心的一件事就是领空投，空手条白狼。这一讲，我们将学习如何使用使用智能合约空投"),n("code",[t._v("ERC20")]),t._v("代币。")]),t._v(" "),n("h2",{attrs:{id:"空投-airdrop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#空投-airdrop"}},[t._v("#")]),t._v(" 空投 Airdrop")]),t._v(" "),n("p",[t._v("空投是币圈中一种营销策略，项目方将代币免费发放给特定用户群体。为了拿到空投资格，用户通常需要完成一些简单的任务，如测试产品、分享新闻、介绍朋友等。项目方通过空投可以获得种子用户，而用户可以获得一笔财富，两全其美。")]),t._v(" "),n("p",[t._v("因为每次接收空投的用户很多，项目方不可能一笔一笔的转账。利用智能合约批量发放"),n("code",[t._v("ERC20")]),t._v("代币，可以显著提高空投效率。")]),t._v(" "),n("h3",{attrs:{id:"空投代币合约"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#空投代币合约"}},[t._v("#")]),t._v(" 空投代币合约")]),t._v(" "),n("p",[n("code",[t._v("Airdrop")]),t._v("空投合约逻辑非常简单：利用循环，一笔交易将"),n("code",[t._v("ERC20")]),t._v("代币发送给多个地址。合约中包含两个函数")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("getSum()")]),t._v("函数：返回"),n("code",[t._v("uint")]),t._v("数组的和。")])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数组求和函数")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pure")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" sum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" _arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            sum "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sum "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" _arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[n("p",[n("code",[t._v("multiTransferToken()")]),t._v("函数：发送"),n("code",[t._v("ERC20")]),t._v("代币空投，包含三个参数：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("_token")]),t._v("：代币合约地址（"),n("code",[t._v("address")]),t._v("类型）")]),t._v(" "),n("li",[n("code",[t._v("_addresses")]),t._v("：接收空投的用户地址数组（"),n("code",[t._v("address[]")]),t._v("类型）")]),t._v(" "),n("li",[n("code",[t._v("_amounts")]),t._v("：空投数量数组，对应"),n("code",[t._v("_addresses")]),t._v("里每个地址的数量（"),n("code",[t._v("uint[]")]),t._v("类型）")])]),t._v(" "),n("p",[t._v("该函数有两个检查：第一个"),n("code",[t._v("require")]),t._v("检查了"),n("code",[t._v("_addresses")]),t._v("和"),n("code",[t._v("_amounts")]),t._v("两个数组长度是否相等；第二个"),n("code",[t._v("require")]),t._v("检查了空投合约的授权额度大于要空投的代币数量总和。")])])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @notice 向多个地址转账ERC20代币，使用前需要先授权")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("///")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _token 转账的ERC20代币地址")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _addresses 空投地址数组")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// @param _amounts 代币数量数组（每个地址的空投数量）")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("multiTransferToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _addresses"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("calldata")]),t._v(" _amounts\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查：_addresses和_amounts数组的长度相等")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_addresses"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" _amounts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Lengths of Addresses and Amounts NOT EQUAL"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        IERC20 token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IERC20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明IERC合约变量")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v(" _amountSum "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_amounts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 计算空投代币总量")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查：授权代币数量 > 空投代币总量")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("allowance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" _amountSum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Need Approve ERC20 token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// for循环，利用transferFrom函数发送空投")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint8")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" _addresses"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transferFrom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _addresses"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _amounts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"空投实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#空投实践"}},[t._v("#")]),t._v(" 空投实践")]),t._v(" "),n("ol",[n("li",[t._v("部署"),n("code",[t._v("ERC20")]),t._v("代币合约，并给自己"),n("code",[t._v("mint")]),t._v(" 10000 单位代币。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(446),alt:"部署"}})]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("部署"),n("code",[t._v("Airdrop")]),t._v("空投合约。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(447),alt:"部署合约"}})]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("利用"),n("code",[t._v("ERC20")]),t._v("代币合约中的"),n("code",[t._v("approve()")]),t._v("函数，给"),n("code",[t._v("Airdrop")]),t._v("空投合约授权10000 单位代币。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(448),alt:"授权合约"}})]),t._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[t._v("执行"),n("code",[t._v("Airdrop")]),t._v("合约的"),n("code",[t._v("multiTransferToken()")]),t._v("函数进行空投， "),n("code",[t._v("_token")]),t._v("填"),n("code",[t._v("ERC20")]),t._v("代币地址，"),n("code",[t._v("_addresses")]),t._v("和"),n("code",[t._v("_amounts")]),t._v("按照以下填写")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('// _addresses填写\n["0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2", "0x5B38Da6a701c568545dCfcB03FcB875f56beddC4"]\n\n// _amounts填写\n[100, 200]\n')])])]),n("p",[n("img",{attrs:{src:a(449),alt:"空投"}})]),t._v(" "),n("ol",{attrs:{start:"5"}},[n("li",[t._v("利用"),n("code",[t._v("ERC20")]),t._v("合约的"),n("code",[t._v("balanceOf()")]),t._v("函数查询上面用户地址的代币余额，成功变为"),n("code",[t._v("100")]),t._v("和"),n("code",[t._v("200")]),t._v("，空投成功！")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(450),alt:"查询空投用户的代币余额"}})]),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("这一讲，我们介绍了如何使用"),n("code",[t._v("solidity")]),t._v("写"),n("code",[t._v("ERC20")]),t._v("代币空投合约，极大增加空投效率。我撸空投收获最大的一次是"),n("code",[t._v("ENS")]),t._v("空投，你们呢？")])])}),[],!1,null,null,null);s.default=e.exports}}]);