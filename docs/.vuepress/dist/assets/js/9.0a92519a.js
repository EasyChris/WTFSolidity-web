(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{446:function(t,s,e){t.exports=e.p+"assets/img/32-1.3c0f5417.png"},447:function(t,s,e){t.exports=e.p+"assets/img/32-2.20215bcc.png"},448:function(t,s,e){t.exports=e.p+"assets/img/32-3.4fd687fc.png"},449:function(t,s,e){t.exports=e.p+"assets/img/32-4.bb6d96d7.png"},450:function(t,s,e){t.exports=e.p+"assets/img/32-5.abefbe7e.png"},505:function(t,s,e){"use strict";e.r(s);var a=e(42),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"solidity极简入门-32-代币水龙头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#solidity极简入门-32-代币水龙头"}},[t._v("#")]),t._v(" Solidity极简入门: 32. 代币水龙头")]),t._v(" "),a("p",[t._v("我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。")]),t._v(" "),a("p",[t._v("欢迎关注我的推特："),a("a",{attrs:{href:"https://twitter.com/0xAA_Science",target:"_blank",rel:"noopener noreferrer"}},[t._v("@0xAA_Science"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("欢迎加入WTF科学家社区，内有加微信群方法："),a("a",{attrs:{href:"https://discord.gg/5akcruXrsk",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: "),a("a",{attrs:{href:"https://github.com/AmazingAng/WTFSolidity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/AmazingAng/WTFSolidity"),a("OutboundLink")],1)]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("我们在第31讲学习了"),a("code",[t._v("ERC20")]),t._v("代币标准。这一讲，我们将学习"),a("code",[t._v("ERC20")]),t._v("水龙头的智能合约。在这个合约中，用户可以领到免费的"),a("code",[t._v("ERC20")]),t._v("代币。")]),t._v(" "),a("h2",{attrs:{id:"代币水龙头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代币水龙头"}},[t._v("#")]),t._v(" 代币水龙头")]),t._v(" "),a("p",[t._v("当人渴的时候，就要去水龙头接水；当人想要免费代币的时候，就要去代币水龙头领。代币水龙头就是让用户免费领代币的网站/应用。")]),t._v(" "),a("p",[t._v("最早的代币水龙头是比特币（BTC）水龙头：现在BTC一枚要$30,000，但是在2010年，BTC的价格只有不到$0.1，并且持有人很少。为了扩大影响力，比特币社区的Gavin Andresen开发了BTC水龙头，让别人可以免费领BTC。撸羊毛大家都喜欢，当时就有很多人去撸，一部分变为了BTC的信徒。BTC水龙头一共送出了超过19,700枚BTC，现在价值约6亿美元！")]),t._v(" "),a("h2",{attrs:{id:"erc20水龙头合约"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#erc20水龙头合约"}},[t._v("#")]),t._v(" ERC20水龙头合约")]),t._v(" "),a("p",[t._v("这里，我们实现一个简版的"),a("code",[t._v("ERC20")]),t._v("水龙头，逻辑非常简单：我们将一些"),a("code",[t._v("ERC20")]),t._v("代币转到水龙头合约里，用户可以通过合约的"),a("code",[t._v("requestToken()")]),t._v("函数来领取"),a("code",[t._v("100")]),t._v("单位的代币，每个地址只能领一次。")]),t._v(" "),a("h3",{attrs:{id:"状态变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#状态变量"}},[t._v("#")]),t._v(" 状态变量")]),t._v(" "),a("p",[t._v("我们在水龙头合约中定义3个状态变量")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("amountAllowed")]),t._v("设定每次能领取代币数量（默认为"),a("code",[t._v("100")]),t._v("。不是一百枚，因为代币有小数位数）。")]),t._v(" "),a("li",[a("code",[t._v("tokenContract")]),t._v("记录发放的"),a("code",[t._v("ERC20")]),t._v("代币合约地址。")]),t._v(" "),a("li",[a("code",[t._v("requestedAddress")]),t._v("记录领取过代币的地址。")])]),t._v(" "),a("div",{staticClass:"language-solidity extra-class"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" amountAllowed "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每次领 100 单位代币")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" tokenContract"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// token合约地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" requestedAddress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 记录领取过代币的地址")]),t._v("\n")])])]),a("h3",{attrs:{id:"事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件"}},[t._v("#")]),t._v(" 事件")]),t._v(" "),a("p",[t._v("水龙头合约中定义了1个"),a("code",[t._v("SendToken")]),t._v("事件，记录了每次领取代币的地址和数量，在"),a("code",[t._v("requestTokens()")]),t._v("函数被调用时释放。")]),t._v(" "),a("div",{staticClass:"language-solidity extra-class"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SendToken事件    ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("event")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SendToken")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("indexed")]),t._v(" Receiver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("indexed")]),t._v(" Amount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),a("h3",{attrs:{id:"函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[t._v("#")]),t._v(" 函数")]),t._v(" "),a("p",[t._v("合约中只有两个函数：")]),t._v(" "),a("ul",[a("li",[t._v("构造函数：初始化"),a("code",[t._v("tokenContract")]),t._v("状态变量，确定发放的"),a("code",[t._v("ERC20")]),t._v("代币地址。")])]),t._v(" "),a("div",{staticClass:"language-solidity extra-class"},[a("pre",{pre:!0,attrs:{class:"language-solidity"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 部署时设定ERC2代币合约")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _tokenContract"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        tokenContract "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _tokenContract"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// set token contract")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("requestTokens()")]),t._v("函数，用户调用它可以领取"),a("code",[t._v("ERC20")]),t._v("代币。")])]),t._v(" "),a("h2",{attrs:{id:"remix演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remix演示"}},[t._v("#")]),t._v(" Remix演示")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("首先，部署"),a("code",[t._v("ERC20")]),t._v("代币合约，并给自己"),a("code",[t._v("mint")]),t._v(" 10000 单位代币。\n"),a("img",{attrs:{src:e(446),alt:"部署"}})])]),t._v(" "),a("li",[a("p",[t._v("部署"),a("code",[t._v("Faucet")]),t._v("水龙头合约，初始化的参数填上面"),a("code",[t._v("ERC20")]),t._v("代币的合约地址。\n"),a("img",{attrs:{src:e(447),alt:"部署水龙头合约"}})])]),t._v(" "),a("li",[a("p",[t._v("利用"),a("code",[t._v("ERC20")]),t._v("代币合约的"),a("code",[t._v("trasnfer()")]),t._v("函数，将 10000 单位代币转账到"),a("code",[t._v("Faucet")]),t._v("合约地址。\n"),a("img",{attrs:{src:e(448),alt:"给水龙头合约转账"}})])]),t._v(" "),a("li",[a("p",[t._v("换一个新账户，调用"),a("code",[t._v("Faucet")]),t._v("合约"),a("code",[t._v("requestTokens()")]),t._v("函数，领取代币。可以在终端看到"),a("code",[t._v("SendToken")]),t._v("事件被释放。\n"),a("img",{attrs:{src:e(449),alt:"requestToken"}})])]),t._v(" "),a("li",[a("p",[t._v("在"),a("code",[t._v("ERC20")]),t._v("代币合约上利用"),a("code",[t._v("balanceOf")]),t._v("查询账户余额，可以看到余额变为"),a("code",[t._v("100")]),t._v("，领取成功！\n"),a("img",{attrs:{src:e(450),alt:"领取成功"}})])])]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("这一讲，我们介绍了代币水龙头的历史和"),a("code",[t._v("ERC20")]),t._v("水龙头合约。大家觉得下一个"),a("code",[t._v("BTC")]),t._v("水龙头会在哪里？")])])}),[],!1,null,null,null);s.default=n.exports}}]);