<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solidity极简入门 ERC721专题5：Loot | 一肩月光 · 笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Live and learn.">
    
    <link rel="preload" href="/assets/css/0.styles.da8d04bd.css" as="style"><link rel="preload" href="/assets/js/app.401b85e8.js" as="script"><link rel="preload" href="/assets/js/2.45986f87.js" as="script"><link rel="preload" href="/assets/js/23.228c7dbc.js" as="script"><link rel="prefetch" href="/assets/js/10.3c40492c.js"><link rel="prefetch" href="/assets/js/11.cbc40964.js"><link rel="prefetch" href="/assets/js/12.8900d9dd.js"><link rel="prefetch" href="/assets/js/13.8297c0e7.js"><link rel="prefetch" href="/assets/js/14.817ba08b.js"><link rel="prefetch" href="/assets/js/15.ff19f338.js"><link rel="prefetch" href="/assets/js/16.64512a51.js"><link rel="prefetch" href="/assets/js/17.60fd1c46.js"><link rel="prefetch" href="/assets/js/18.bce8f2f9.js"><link rel="prefetch" href="/assets/js/19.6eb8107a.js"><link rel="prefetch" href="/assets/js/20.965af391.js"><link rel="prefetch" href="/assets/js/21.925022da.js"><link rel="prefetch" href="/assets/js/22.093887f3.js"><link rel="prefetch" href="/assets/js/24.f69b60cb.js"><link rel="prefetch" href="/assets/js/25.16477dfe.js"><link rel="prefetch" href="/assets/js/26.38e58306.js"><link rel="prefetch" href="/assets/js/27.aedcaa81.js"><link rel="prefetch" href="/assets/js/28.812e41fc.js"><link rel="prefetch" href="/assets/js/29.46e28048.js"><link rel="prefetch" href="/assets/js/3.a7d4947f.js"><link rel="prefetch" href="/assets/js/30.30fb5717.js"><link rel="prefetch" href="/assets/js/31.818caeb7.js"><link rel="prefetch" href="/assets/js/32.4e90d34a.js"><link rel="prefetch" href="/assets/js/33.e347014f.js"><link rel="prefetch" href="/assets/js/34.32880e38.js"><link rel="prefetch" href="/assets/js/35.ba4ba556.js"><link rel="prefetch" href="/assets/js/36.894e59b2.js"><link rel="prefetch" href="/assets/js/37.4586bc0e.js"><link rel="prefetch" href="/assets/js/38.d6602bcd.js"><link rel="prefetch" href="/assets/js/39.4801db25.js"><link rel="prefetch" href="/assets/js/4.5ace8b0e.js"><link rel="prefetch" href="/assets/js/40.b6e8b6bb.js"><link rel="prefetch" href="/assets/js/41.da07455f.js"><link rel="prefetch" href="/assets/js/42.e8c305c7.js"><link rel="prefetch" href="/assets/js/43.ca0a7f96.js"><link rel="prefetch" href="/assets/js/44.bd817410.js"><link rel="prefetch" href="/assets/js/45.9138306f.js"><link rel="prefetch" href="/assets/js/46.9b2b51f4.js"><link rel="prefetch" href="/assets/js/5.1189ae9f.js"><link rel="prefetch" href="/assets/js/6.4db7abcd.js"><link rel="prefetch" href="/assets/js/7.f5f4f264.js"><link rel="prefetch" href="/assets/js/8.7c2bd1fc.js"><link rel="prefetch" href="/assets/js/9.0a92519a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.da8d04bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">一肩月光 · 笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/AmazingAng/WTFSolidity" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WTFSolidity
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/EasyChris/WTFSolidity-web" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/AmazingAng/WTFSolidity" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WTFSolidity
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/EasyChris/WTFSolidity-web" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hello Web 3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Value Types</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Function</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Return</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data Storage</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Array And Struct</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mapping</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Initial Value</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Constant</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Insertion Sort</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Modifier</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Event</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Inheritance</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Interface</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Errors</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Overloading</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Library</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Import</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Fallback</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Send ETH</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Call Contract</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Call</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Delegatecall</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Create</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Create 2</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Delete Contract</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ABI Encode</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Hash</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Selector</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Try Catch</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ERC 20</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Faucet Sol</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Img</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>专题</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zhuan-ti/" aria-current="page" class="sidebar-link">/zhuan-ti/</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>ERC 721</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zhuan-ti/erc721/loot/" aria-current="page" class="active sidebar-link">Solidity极简入门 ERC721专题5：Loot</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zhuan-ti/erc721/loot/#loot" class="sidebar-link">Loot</a></li><li class="sidebar-sub-header"><a href="/zhuan-ti/erc721/loot/#loot代码" class="sidebar-link">Loot代码</a></li><li class="sidebar-sub-header"><a href="/zhuan-ti/erc721/loot/#loot的铸造漏洞" class="sidebar-link">Loot的铸造漏洞</a></li><li class="sidebar-sub-header"><a href="/zhuan-ti/erc721/loot/#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="solidity极简入门-erc721专题5-loot"><a href="#solidity极简入门-erc721专题5-loot" class="header-anchor">#</a> Solidity极简入门 ERC721专题5：Loot</h1> <p>我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。</p> <p>欢迎关注我的推特：<a href="https://twitter.com/0xAA_Science" target="_blank" rel="noopener noreferrer">@0xAA_Science<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>WTF技术社群discord，内有加微信群方法：<a href="https://discord.gg/5akcruXrsk" target="_blank" rel="noopener noreferrer">链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: <a href="https://github.com/AmazingAng/WTFSolidity" target="_blank" rel="noopener noreferrer">github.com/AmazingAng/WTFSolidity<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <h2 id="loot"><a href="#loot" class="header-anchor">#</a> Loot</h2> <p><img src="/assets/img/Loot-1.25c33337.png" alt=""></p> <p><code>Loot</code>是以太坊链上的实验性NFT项目，发行于21年8月，共有8000个，前7777个免费<code>mint</code>，后233个项目方预留，最高时地板价突破20 <code>ETH</code>，目前稳定在1 <code>ETH</code>左右。与充斥市场的图片NFT不同，<code>Loot</code>是文字类NFT，所有元数据都保存在链上，保证了去中心化，没人能篡改。</p> <p>它的内容比较简单，就是用文字描述了玩家的一套装备，包括武器、头盔、戒指共8类物品。“金指环”，“双子之剑”，“硬皮手套”，复古的名字让我回忆起小时候玩的《暗黑破坏神》。</p> <p><code>Loot</code>是一个开放的生态，项目方希望有更多团队能加入到<code>Loot</code>元宇宙的建设中。这一讲，我将介绍<code>Loot</code>是怎么用智能合约生成的文字，又是怎么把它放上链的。</p> <h2 id="loot代码"><a href="#loot代码" class="header-anchor">#</a> Loot代码</h2> <p><code>Loot</code>代码在etherscan上开源，地址：<a href="https://etherscan.io/address/0xff9c1b15b16263c61d017ee9f65c50e4ae0113d7#code" target="_blank" rel="noopener noreferrer">链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>主合约<code>Loot</code>从<code>1291行</code>开始，继承了<code>ERC721Enumerable</code>，<code>ReentrancyGuard</code>和<code>Ownable</code>，这些合约都是<code>oppenzepplin</code>标准库中的。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">Loot</span> <span class="token keyword">is</span> ERC721Enumerable<span class="token punctuation">,</span> ReentrancyGuard<span class="token punctuation">,</span> Ownable <span class="token punctuation">{</span>
</code></pre></div><h3 id="_1-装备描述基本词组"><a href="#_1-装备描述基本词组" class="header-anchor">#</a> 1. 装备描述基本词组</h3> <p><code>Loot</code>在状态变量中定义了11个<code>String数组</code>用于生成装备描述的基本词组：</p> <ul><li>其中8个是装备列表，用于描述不同部位的装备，包括<code>weapon</code>, <code>chestArmor</code>, <code>headArmor</code>, <code>waistArmor</code>, <code>footArmor</code>, <code>handArmor</code>, <code>necklaces</code>, <code>rings</code>。拿<code>weapon</code>举例，它的<code>String数组</code>包含<code>战锤</code>, <code>木棒</code>等内容：</li></ul> <div class="language-solidity extra-class"><pre class="language-solidity"><code>        <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">private</span> weapons <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;Warhammer&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Quarterstaff&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Maul&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Mace&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Club&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Katana&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Falchion&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Scimitar&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Long Sword&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Short Sword&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Ghost Wand&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Grave Wand&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Bone Wand&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Wand&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Grimoire&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Chronicle&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Tome&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Book&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>剩余3个是修饰装备的前缀和后缀，包括<code>suffixes</code>, <code>namePrefixes</code>和<code>nameSuffixes</code>。前缀后缀可以让装备看起来更牛逼，例如：<code>龙的完美之冠</code>，<code>鹰吼-华丽的巨人胸甲</code>。拿装备后缀举例，<code>suffixes</code>包括：</li></ul> <div class="language-solidity extra-class"><pre class="language-solidity"><code>    <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">private</span> suffixes <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;of Power&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Giants&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Titans&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Skill&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Perfection&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Brilliance&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Enlightenment&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Protection&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Anger&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Rage&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Fury&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Vitriol&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of the Fox&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Detection&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of Reflection&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;of the Twins&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>装备列表和修饰词随机结合，就能生成出<code>Loot</code>的文本NFT。</p> <h3 id="_2-随机生成描述文本"><a href="#_2-随机生成描述文本" class="header-anchor">#</a> 2. 随机生成描述文本</h3> <p>为了区分装备的稀有度，<code>Loot</code>利用链上伪随机数生成函数<code>random()</code>为装备描述文本提供随机性：</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>    <span class="token keyword">function</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> input<span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token builtin">uint256</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><code>random()</code>函数参数为<code>input</code>字符串，它计算<code>input</code>的哈希，再转换为<code>uint256</code>，将不同的<code>input</code>均匀的映射到不同的数字上。之后将得到数字映射到稀有度，就可以了，<code>Loot</code>定义了<code>pluck()</code>函数来做这一点。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>    <span class="token keyword">function</span> <span class="token function">pluck</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> keyPrefix<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> sourceArray<span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint256</span> rand <span class="token operator">=</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>keyPrefix<span class="token punctuation">,</span> <span class="token function">toString</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">string</span> <span class="token keyword">memory</span> output <span class="token operator">=</span> sourceArray<span class="token punctuation">[</span>rand <span class="token operator">%</span> sourceArray<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token builtin">uint256</span> greatness <span class="token operator">=</span> rand <span class="token operator">%</span> <span class="token number">21</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>greatness <span class="token operator">&gt;</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            output <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> suffixes<span class="token punctuation">[</span>rand <span class="token operator">%</span> suffixes<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>greatness <span class="token operator">&gt;=</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> name<span class="token punctuation">;</span>
            name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> namePrefixes<span class="token punctuation">[</span>rand <span class="token operator">%</span> namePrefixes<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
            name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> nameSuffixes<span class="token punctuation">[</span>rand <span class="token operator">%</span> nameSuffixes<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>greatness <span class="token operator">==</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                output <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span><span class="token string">'&quot;'</span><span class="token punctuation">,</span> name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'&quot; '</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                output <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span><span class="token string">'&quot;'</span><span class="token punctuation">,</span> name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'&quot; '</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span> <span class="token string">&quot; +1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> output<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><code>pluck()</code>函数的作用就是在给定<code>tokenId</code>, <code>keyPrefix</code> (装备部位)和<code>sourceArray</code> (装备列表)，来生成特定部位装备的描述。一个装备有<code>33.3%</code>的概率拥有后缀，其中有<code>9.5%</code>的概率拥有<code>特殊名称</code>。因此，<code>Loot</code>中每件装备有<code>66.7%</code>为普通，<code>23.8%</code>为稀有，<code>9.5%</code>为史诗。</p> <p><code>Loot</code>包含8个<code>get()</code>函数来获取8个部位的装备，拿<code>getWeapon()</code>举例，这个函数获得武器描述：它调用了<code>pluck</code>函数，装备部位为<code>&quot;WEAPON&quot;</code>,装备列表为状态变量<code>weapons</code>。</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>    <span class="token keyword">function</span> <span class="token function">getWeapon</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">pluck</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">,</span> <span class="token string">&quot;WEAPON&quot;</span><span class="token punctuation">,</span> weapons<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-元数据上链"><a href="#_3-元数据上链" class="header-anchor">#</a> 3. 元数据上链</h3> <p>由于<code>keyPrefix</code>和<code>sourceArray</code>都是复用的，因此<code>Loot</code>的装备描述
/稀有度完全由<code>tokenId</code>决定：给定<code>tokenId</code>，总会得到同一组装备。因此，<code>Loot</code>没有&quot;保存&quot;所有装备描述。每次用户查询元数据的时候，合约会生成一份装备描述。这个方法非常创新非常聪明，显著减少了存储占用，让元数据上链成为可能。</p> <p>我们看一下它的<code>tokenURI()</code>函数：</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>    <span class="token keyword">function</span> <span class="token function">tokenURI</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> tokenId<span class="token punctuation">)</span> override <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> parts<span class="token punctuation">;</span>
        parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; preserveAspectRatio=&quot;xMinYMin meet&quot; viewBox=&quot;0 0 350 350&quot;&gt;&lt;style&gt;.base { fill: white; font-family: serif; font-size: 14px; }&lt;/style&gt;&lt;rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;black&quot; /&gt;&lt;text x=&quot;10&quot; y=&quot;20&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getWeapon</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;text x=&quot;10&quot; y=&quot;40&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getChest</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;text x=&quot;10&quot; y=&quot;60&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getHead</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;text x=&quot;10&quot; y=&quot;80&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getWaist</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;text x=&quot;10&quot; y=&quot;100&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getFoot</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;text x=&quot;10&quot; y=&quot;120&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getHand</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;text x=&quot;10&quot; y=&quot;140&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getNeck</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;text x=&quot;10&quot; y=&quot;160&quot; class=&quot;base&quot;&gt;'</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getRing</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        parts<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'&lt;/text&gt;&lt;/svg&gt;'</span><span class="token punctuation">;</span>

        <span class="token builtin">string</span> <span class="token keyword">memory</span> output <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        output <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parts<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token builtin">string</span> <span class="token keyword">memory</span> json <span class="token operator">=</span> Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span><span class="token string">'{&quot;name&quot;: &quot;Bag #'</span><span class="token punctuation">,</span> <span class="token function">toString</span><span class="token punctuation">(</span>tokenId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&quot;, &quot;description&quot;: &quot;Loot is randomized adventurer gear generated and stored on chain. Stats, images, and other functionality are intentionally omitted for others to interpret. Feel free to use Loot in any way you want.&quot;, &quot;image&quot;: &quot;data:image/svg+xml;base64,'</span><span class="token punctuation">,</span> Base64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&quot;}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        output <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span><span class="token string">'data:application/json;base64,'</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> output<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>一般pfp NFT的<code>tokenURI()</code>函数是直接返回一个带有元数据<code>json</code>的网址；而<code>Loot</code>的则是直接返回一个<code>json</code>。它定义了<code>parts</code>变量，然后通过8个<code>get()</code>函数拼接出含有装备描述的<code>svg</code>文件，作为元数据的<code>image</code>，方便展示。最后，它把<code>name</code>，<code>description</code>和<code>image</code>一起打包成一个<code>Base64</code>编码的<code>json</code>，作为<code>tokenURI()</code>查询的返回值。</p> <p>下面是一个<code>tokenURI()</code>的返回值例子：</p> <div class="language-solidity extra-class"><pre class="language-solidity"><code>data<span class="token punctuation">:</span>application<span class="token operator">/</span>json<span class="token punctuation">;</span>base64<span class="token punctuation">,</span>eyJuYW1lIjogIkJhZyAjNSIsICJkZXNjcmlwdGlvbiI6ICJMb290IGlzIHJhbmRvbWl6ZWQgYWR2ZW50dXJlciBnZWFyIGdlbmVyYXRlZCBhbmQgc3RvcmVkIG9uIGNoYWluLiBTdGF0cywgaW1hZ2VzLCBhbmQgb3RoZXIgZnVuY3Rpb25hbGl0eSBhcmUgaW50ZW50aW9uYWxseSBvbWl0dGVkIGZvciBvdGhlcnMgdG8gaW50ZXJwcmV0LiBGZWVsIGZyZWUgdG8gdXNlIExvb3QgaW4gYW55IHdheSB5b3Ugd2FudC4iLCAiaW1hZ2UiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhCeVpYTmxjblpsUVhOd1pXTjBVbUYwYVc4OUluaE5hVzVaVFdsdUlHMWxaWFFpSUhacFpYZENiM2c5SWpBZ01DQXpOVEFnTXpVd0lqNDhjM1I1YkdVK0xtSmhjMlVnZXlCbWFXeHNPaUIzYUdsMFpUc2dabTl1ZEMxbVlXMXBiSGs2SUhObGNtbG1PeUJtYjI1MExYTnBlbVU2SURFMGNIZzdJSDA4TDNOMGVXeGxQanh5WldOMElIZHBaSFJvUFNJeE1EQWxJaUJvWldsbmFIUTlJakV3TUNVaUlHWnBiR3c5SW1Kc1lXTnJJaUF2UGp4MFpYaDBJSGc5SWpFd0lpQjVQU0l5TUNJZ1kyeGhjM005SW1KaGMyVWlQazFoZFd3Z2IyWWdVbVZtYkdWamRHbHZiand2ZEdWNGRENDhkR1Y0ZENCNFBTSXhNQ0lnZVQwaU5EQWlJR05zWVhOelBTSmlZWE5sSWo1UWJHRjBaU0JOWVdsc1BDOTBaWGgwUGp4MFpYaDBJSGc5SWpFd0lpQjVQU0kyTUNJZ1kyeGhjM005SW1KaGMyVWlQa1J5WVdkdmJpZHpJRU55YjNkdUlHOW1JRkJsY21abFkzUnBiMjQ4TDNSbGVIUStQSFJsZUhRZ2VEMGlNVEFpSUhrOUlqZ3dJaUJqYkdGemN6MGlZbUZ6WlNJK1UyRnphRHd2ZEdWNGRENDhkR1Y0ZENCNFBTSXhNQ0lnZVQwaU1UQXdJaUJqYkdGemN6MGlZbUZ6WlNJK1NHOXNlU0JIY21WaGRtVnpQQzkwWlhoMFBqeDBaWGgwSUhnOUlqRXdJaUI1UFNJeE1qQWlJR05zWVhOelBTSmlZWE5sSWo1SVlYSmtJRXhsWVhSb1pYSWdSMnh2ZG1WelBDOTBaWGgwUGp4MFpYaDBJSGc5SWpFd0lpQjVQU0l4TkRBaUlHTnNZWE56UFNKaVlYTmxJajVRWlc1a1lXNTBQQzkwWlhoMFBqeDBaWGgwSUhnOUlqRXdJaUI1UFNJeE5qQWlJR05zWVhOelBTSmlZWE5sSWo1VWFYUmhibWwxYlNCU2FXNW5QQzkwWlhoMFBqd3ZjM1puUGc9PSJ9
</code></pre></div><p>把它复制到浏览器打开，可以直接获取<code>Loot</code>的元数据，挺神奇的：
<img src="/assets/img/Loot-2.17cd43d0.png" alt=""></p> <p>下面是<code>Loot</code>生成的文字描述<code>svg</code>图片的例子</p> <div class="language- extra-class"><pre class="language-text"><code>data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaW5ZTWluIG1lZXQiIHZpZXdCb3g9IjAgMCAzNTAgMzUwIj48c3R5bGU+LmJhc2UgeyBmaWxsOiB3aGl0ZTsgZm9udC1mYW1pbHk6IHNlcmlmOyBmb250LXNpemU6IDE0cHg7IH08L3N0eWxlPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9ImJsYWNrIiAvPjx0ZXh0IHg9IjEwIiB5PSIyMCIgY2xhc3M9ImJhc2UiPk1hdWwgb2YgUmVmbGVjdGlvbjwvdGV4dD48dGV4dCB4PSIxMCIgeT0iNDAiIGNsYXNzPSJiYXNlIj5QbGF0ZSBNYWlsPC90ZXh0Pjx0ZXh0IHg9IjEwIiB5PSI2MCIgY2xhc3M9ImJhc2UiPkRyYWdvbidzIENyb3duIG9mIFBlcmZlY3Rpb248L3RleHQ+PHRleHQgeD0iMTAiIHk9IjgwIiBjbGFzcz0iYmFzZSI+U2FzaDwvdGV4dD48dGV4dCB4PSIxMCIgeT0iMTAwIiBjbGFzcz0iYmFzZSI+SG9seSBHcmVhdmVzPC90ZXh0Pjx0ZXh0IHg9IjEwIiB5PSIxMjAiIGNsYXNzPSJiYXNlIj5IYXJkIExlYXRoZXIgR2xvdmVzPC90ZXh0Pjx0ZXh0IHg9IjEwIiB5PSIxNDAiIGNsYXNzPSJiYXNlIj5QZW5kYW50PC90ZXh0Pjx0ZXh0IHg9IjEwIiB5PSIxNjAiIGNsYXNzPSJiYXNlIj5UaXRhbml1bSBSaW5nPC90ZXh0Pjwvc3ZnPg==
</code></pre></div><p>把它复制到浏览器打开，得到下面的图片：</p> <p><img src="/assets/img/Loot-3.28ca1a10.png" alt=""></p> <h2 id="loot的铸造漏洞"><a href="#loot的铸造漏洞" class="header-anchor">#</a> Loot的铸造漏洞</h2> <p>由于<code>tokenId</code>对应的稀有度在<code>mint</code>前已经决定，黑客可以写一个合约来<code>mint</code>稀有的NFT。</p> <p>具体方法：计算每个<code>tokenURI</code>对应在<code>pluck()</code>函数中<code>greatness</code>，当<code>greatness%21 &gt;= 19</code>，装备必是史诗。优先加高<code>gas</code>来<code>mint</code>这类稀有的<code>Loot NFT</code>。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p><code>Loot</code>是我知道的第一个将元数据全部上链的文字<code>NFT</code>项目，非常有开创性和可拓展性。它并不是把元数据直接存到链上（太费链上存储空间），而是每次都通过智能合约重新生成一份元数据返回。如果大家想<code>fork</code>这个项目，需要认真看下<code>random()</code>, <code>pluck()</code>和<code>tokenURI()</code>这三个函数。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/29/2022, 10:06:07 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zhuan-ti/" class="prev router-link-active">
        /zhuan-ti/
      </a></span> <span class="next"><a href="/zhuan-ti/security/consensys2020/">
        Metamask项目方给Solidity程序员的16个安全建议
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.401b85e8.js" defer></script><script src="/assets/js/2.45986f87.js" defer></script><script src="/assets/js/23.228c7dbc.js" defer></script>
  </body>
</html>
