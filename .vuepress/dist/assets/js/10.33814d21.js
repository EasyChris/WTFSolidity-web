(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{452:function(t,s,a){t.exports=a.p+"assets/img/32-1.3c0f5417.png"},453:function(t,s,a){t.exports=a.p+"assets/img/32-2.20215bcc.png"},454:function(t,s,a){t.exports=a.p+"assets/img/32-3.4fd687fc.png"},455:function(t,s,a){t.exports=a.p+"assets/img/32-4.bb6d96d7.png"},456:function(t,s,a){t.exports=a.p+"assets/img/32-5.abefbe7e.png"},518:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"solidity极简入门-32-代币水龙头"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#solidity极简入门-32-代币水龙头"}},[t._v("#")]),t._v(" Solidity极简入门: 32. 代币水龙头")]),t._v(" "),n("p",[t._v("我最近在重新学solidity，巩固一下细节，也写一个“Solidity极简入门”，供小白们使用（编程大佬可以另找教程），每周更新1-3讲。")]),t._v(" "),n("p",[t._v("欢迎关注我的推特："),n("a",{attrs:{href:"https://twitter.com/0xAA_Science",target:"_blank",rel:"noopener noreferrer"}},[t._v("@0xAA_Science"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("欢迎加入WTF科学家社区，内有加微信群方法："),n("a",{attrs:{href:"https://discord.gg/5akcruXrsk",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("所有代码和教程开源在github（1024个star发课程认证，2048个star发社群NFT）: "),n("a",{attrs:{href:"https://github.com/AmazingAng/WTFSolidity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/AmazingAng/WTFSolidity"),n("OutboundLink")],1)]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("我们在第31讲学习了"),n("code",[t._v("ERC20")]),t._v("代币标准。这一讲，我们将学习"),n("code",[t._v("ERC20")]),t._v("水龙头的智能合约。在这个合约中，用户可以领到免费的"),n("code",[t._v("ERC20")]),t._v("代币。")]),t._v(" "),n("h2",{attrs:{id:"代币水龙头"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代币水龙头"}},[t._v("#")]),t._v(" 代币水龙头")]),t._v(" "),n("p",[t._v("当人渴的时候，就要去水龙头接水；当人想要免费代币的时候，就要去代币水龙头领。代币水龙头就是让用户免费领代币的网站/应用。")]),t._v(" "),n("p",[t._v("最早的代币水龙头是比特币（BTC）水龙头：现在BTC一枚要$30,000，但是在2010年，BTC的价格只有不到$0.1，并且持有人很少。为了扩大影响力，比特币社区的Gavin Andresen开发了BTC水龙头，让别人可以免费领BTC。撸羊毛大家都喜欢，当时就有很多人去撸，一部分变为了BTC的信徒。BTC水龙头一共送出了超过19,700枚BTC，现在价值约6亿美元！")]),t._v(" "),n("h2",{attrs:{id:"erc20水龙头合约"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#erc20水龙头合约"}},[t._v("#")]),t._v(" ERC20水龙头合约")]),t._v(" "),n("p",[t._v("这里，我们实现一个简版的"),n("code",[t._v("ERC20")]),t._v("水龙头，逻辑非常简单：我们将一些"),n("code",[t._v("ERC20")]),t._v("代币转到水龙头合约里，用户可以通过合约的"),n("code",[t._v("requestToken()")]),t._v("函数来领取"),n("code",[t._v("100")]),t._v("单位的代币，每个地址只能领一次。")]),t._v(" "),n("h3",{attrs:{id:"状态变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#状态变量"}},[t._v("#")]),t._v(" 状态变量")]),t._v(" "),n("p",[t._v("我们在水龙头合约中定义3个状态变量")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("amountAllowed")]),t._v("设定每次能领取代币数量（默认为"),n("code",[t._v("100")]),t._v("。不是一百枚，因为代币有小数位数）。")]),t._v(" "),n("li",[n("code",[t._v("tokenContract")]),t._v("记录发放的"),n("code",[t._v("ERC20")]),t._v("代币合约地址。")]),t._v(" "),n("li",[n("code",[t._v("requestedAddress")]),t._v("记录领取过代币的地址。")])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" amountAllowed "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每次领 100 单位代币")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" tokenContract"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// token合约地址")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" requestedAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 记录领取过代币的地址")]),t._v("\n")])])]),n("h3",{attrs:{id:"事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事件"}},[t._v("#")]),t._v(" 事件")]),t._v(" "),n("p",[t._v("水龙头合约中定义了1个"),n("code",[t._v("SendToken")]),t._v("事件，记录了每次领取代币的地址和数量，在"),n("code",[t._v("requestTokens()")]),t._v("函数被调用时释放。")]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SendToken事件    ")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("event")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SendToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("indexed")]),t._v(" Receiver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint256")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("indexed")]),t._v(" Amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),n("h3",{attrs:{id:"函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[t._v("#")]),t._v(" 函数")]),t._v(" "),n("p",[t._v("合约中只有两个函数：")]),t._v(" "),n("ul",[n("li",[t._v("构造函数：初始化"),n("code",[t._v("tokenContract")]),t._v("状态变量，确定发放的"),n("code",[t._v("ERC20")]),t._v("代币地址。")])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 部署时设定ERC2代币合约")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),t._v(" _tokenContract"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        tokenContract "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _tokenContract"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// set token contract")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[n("code",[t._v("requestTokens()")]),t._v("函数，用户调用它可以领取"),n("code",[t._v("ERC20")]),t._v("代币。")])]),t._v(" "),n("div",{staticClass:"language-solidity extra-class"},[n("pre",{pre:!0,attrs:{class:"language-solidity"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户领取代币函数")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestTokens")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("external")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requestedAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Can\'t Request Multiple Times!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每个地址只能领一次")]),t._v("\n        IERC20 token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IERC20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tokenContract"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建IERC20合约对象")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("balanceOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" amountAllowed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Faucet Empty!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 水龙头空了")]),t._v("\n\n        token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transfer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" amountAllowed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送token")]),t._v("\n        requestedAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 记录领取地址 ")]),t._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("emit")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SendToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" amountAllowed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 释放SendToken事件")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"remix演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#remix演示"}},[t._v("#")]),t._v(" Remix演示")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("首先，部署"),n("code",[t._v("ERC20")]),t._v("代币合约，并给自己"),n("code",[t._v("mint")]),t._v(" 10000 单位代币。\n"),n("img",{attrs:{src:a(452),alt:"部署"}})])]),t._v(" "),n("li",[n("p",[t._v("部署"),n("code",[t._v("Faucet")]),t._v("水龙头合约，初始化的参数填上面"),n("code",[t._v("ERC20")]),t._v("代币的合约地址。\n"),n("img",{attrs:{src:a(453),alt:"部署水龙头合约"}})])]),t._v(" "),n("li",[n("p",[t._v("利用"),n("code",[t._v("ERC20")]),t._v("代币合约的"),n("code",[t._v("transfer()")]),t._v("函数，将 10000 单位代币转账到"),n("code",[t._v("Faucet")]),t._v("合约地址。\n"),n("img",{attrs:{src:a(454),alt:"给水龙头合约转账"}})])]),t._v(" "),n("li",[n("p",[t._v("换一个新账户，调用"),n("code",[t._v("Faucet")]),t._v("合约"),n("code",[t._v("requestTokens()")]),t._v("函数，领取代币。可以在终端看到"),n("code",[t._v("SendToken")]),t._v("事件被释放。\n"),n("img",{attrs:{src:a(455),alt:"requestToken"}})])]),t._v(" "),n("li",[n("p",[t._v("在"),n("code",[t._v("ERC20")]),t._v("代币合约上利用"),n("code",[t._v("balanceOf")]),t._v("查询账户余额，可以看到余额变为"),n("code",[t._v("100")]),t._v("，领取成功！\n"),n("img",{attrs:{src:a(456),alt:"领取成功"}})])])]),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("这一讲，我们介绍了代币水龙头的历史和"),n("code",[t._v("ERC20")]),t._v("水龙头合约。大家觉得下一个"),n("code",[t._v("BTC")]),t._v("水龙头会在哪里？")])])}),[],!1,null,null,null);s.default=e.exports}}]);